document.onkeydown=function(a){return 123==a.keyCode||a.ctrlKey&&a.shiftKey&&(74===a.keyCode||73===a.keyCode||67===a.keyCode)||a.ctrlKey&&85===a.keyCode?(btf.snackbarShow("\u4F60\u771F\u574F\uFF0C\u4E0D\u80FD\u6253\u5F00\u63A7\u5236\u53F0\u5594!"),event.keyCode=0,event.returnValue=!1,!1):(a.ctrlKey||a.metaKey)&&67==a.keyCode&&""!=selectTextNow?(btf.snackbarShow("\u590D\u5236\u6210\u529F"),rightmenuCopyText(selectTextNow),!1):void 0};var rm={};rm.showRightMenu=function(b,c=0,d=0){let a=$("#rightMenu");a.css("top",c+"px").css("left",d+"px"),b?(stopMaskScroll(),a.show()):a.hide()};let rmWidth=$("#rightMenu").width(),rmHeight=$("#rightMenu").height();rm.reloadrmSize=function(){rmWidth=$("#rightMenu").width(),rmHeight=$("#rightMenu").height()};let domhref="",domImgSrc="",selectTextNow="";function selceText(){let a;selectTextNow=(a=document.selection?document.selection.createRange().text:window.getSelection()+"")?a:""}function removeRightMenu(){rm.showRightMenu(!1),$("#rightmenu-mask").attr("style","display: none")}function stopMaskScroll(){document.getElementById("rightmenu-mask")&&document.getElementById("rightmenu-mask").addEventListener("mousewheel",function(a){removeRightMenu()},!1),document.getElementById("rightMenu")&&document.getElementById("rightMenu").addEventListener("mousewheel",function(a){removeRightMenu()},!1)}function switchDarkMode(){removeRightMenu();let a="dark"===document.documentElement.getAttribute("data-theme")?"dark":"light";"light"===a?(activateDarkMode(),saveToLocal.set("theme","dark",2),void 0!==GLOBAL_CONFIG.Snackbar&&btf.snackbarShow(GLOBAL_CONFIG.Snackbar.day_to_night)):(activateLightMode(),saveToLocal.set("theme","light",2),void 0!==GLOBAL_CONFIG.Snackbar&&btf.snackbarShow(GLOBAL_CONFIG.Snackbar.night_to_day)),"function"==typeof utterancesTheme&&utterancesTheme(),"object"==typeof FB&&window.loadFBComment(),window.DISQUS&&document.getElementById("disqus_thread").children.length&&setTimeout(()=>window.disqusReset(),200)}function copyUrl(b){$("body").after("<input id='copyVal'></input>");var a=document.getElementById("copyVal");a.value=b,a.select(),a.setSelectionRange(0,a.value.length),document.execCommand("copy"),$("#copyVal").remove()}function copyPageUrl(){copyUrl(window.location.href),btf.snackbarShow("\u590D\u5236\u672C\u9875\u94FE\u63A5\u5730\u5740\u6210\u529F"),removeRightMenu()}function rightmenuCopyText(b,d="no-add"){var c;let a=GLOBAL_CONFIG.copyright;c="add-copyright"==d&&b.length>a.limitCount?b+"\n\n\n"+a.languages.author+"\n"+a.languages.link+window.location.href+"\n"+a.languages.source+"\n"+a.languages.info:b,navigator.clipboard&&navigator.clipboard.writeText(c),removeRightMenu()}function imageToBlob(a){console.log(a);let b=new Image;image.crossOrigin="Anonymous";let c=document.createElement("canvas"),d=c.getContext("2d");return b.crossOrigin="",b.src=a,new Promise(a=>{b.onload=function(){c.width=this.naturalWidth,c.height=this.naturalHeight,d.drawImage(this,0,0),c.toBlob(b=>{a(b)},"image/png",.75)}})}async function copyImage(a){let b=await imageToBlob(a),c=new ClipboardItem({"image/png":b});navigator.clipboard.write([c])}function writeClipImg(a){if(removeRightMenu(),-1==a.indexOf(location.host)){btf.snackbarShow("\u56FE\u7247\u4E0D\u540C\u6E90\uFF0C\u7531\u4E8ECORS\u9650\u5236\uFF0C\u5C06\u65E0\u6CD5\u63D0\u53D6\u4F4D\u56FE\uFF01");return}btf.snackbarShow("\u6B63\u5728\u4E0B\u8F7D\u4E2D\uFF0C\u8BF7\u7A0D\u540E",!1,1e4),!1==rm.downloadimging&&(rm.downloadimging=!0,setTimeout(function(){copyImage(a),btf.snackbarShow("\u590D\u5236\u6210\u529F\uFF01\u56FE\u7247\u5DF2\u6DFB\u52A0\u76F2\u6C34\u5370\uFF0C\u8BF7\u9075\u5B88\u7248\u6743\u534F\u8BAE"),rm.downloadimging=!1},"10000"))}function downloadImage(a,b){removeRightMenu(),setTimeout(function(){let c=document.createElement("a"),d=new MouseEvent("click");c.download=b||"photo",c.href=a,c.click(),c.dispatchEvent(d),rm.downloadimging=!1},2e3)}function searchBaidu(){btf.snackbarShow("\u5373\u5C06\u8DF3\u8F6C\u5230\u767E\u5EA6\u641C\u7D22"),setTimeout(function(){window.open("https://www.baidu.com/s?wd="+selectTextNow)},"2000"),removeRightMenu()}function switchReadMode(d){let b=document.body,a;function c(){b.classList.remove("read-mode"),a.remove(),a.removeEventListener("click",c)}0==d?(b.classList.add("read-mode"),(a=document.createElement("button")).type="button",a.className="fas fa-sign-out-alt exit-readmode",b.appendChild(a),a.addEventListener("click",c)):c(),removeRightMenu()}document.onmouseup=document.ondbclick=selceText,window.oncontextmenu=function(a){if(document.body.clientWidth>768){let c=a.clientX+10,d=a.clientY,r=$(".rightMenuNormal"),e=$(".rightMenuOther"),j=$(".rightMenuPlugin"),k=$("#menu-copytext"),l=$("#menu-commenttext"),m=$("#menu-newwindow"),n=$("#menu-copylink"),f=$("#menu-copyimg"),g=$("#menu-downloadimg"),o=$("#menu-search"),p=$("#menu-searchBaidu"),q=$("#menu-readmode"),h=a.target.href,b=a.target.currentSrc,s=location.href.includes("articles"),i=!1;return r.show(),e.show(),selectTextNow&&window.getSelection()?(i=!0,k.show(),l.show(),o.show(),p.show(),e.hide()):(k.hide(),l.hide(),p.hide(),o.hide()),h||b?(i=!0,m.show(),n.show(),e.hide(),h&&(domhref=h),b?(domImgSrc=b,domhref=b,f.show(),g.show()):(f.hide(),g.hide())):(f.hide(),g.hide(),m.hide(),n.hide()),s?q.show():q.hide(),i?j.show():j.hide(),rm.reloadrmSize(),c+rmWidth>window.innerWidth&&(c-=rmWidth),d+rmHeight>window.innerHeight&&(d-=rmHeight),rm.showRightMenu(!0,d,c),$("#rightmenu-mask").attr("style","display: flex"),!1}},$("#menu-backward").on("click",function(){window.history.back()}),$("#menu-forward").on("click",function(){window.history.forward()}),$("#menu-refresh").on("click",function(){window.location.reload()}),$("#menu-darkmode").on("click",function(){switchDarkMode()}),$("#menu-home").on("click",function(){window.location.href=window.location.origin}),$(".menu-link").on("click",function(){removeRightMenu()}),rm.downloadimging=!1,$("#menu-copy").on("click",function(){copyPageUrl()}),$("#menu-newwindow").on("click",function(){window.open(domhref),removeRightMenu()}),$("#menu-copylink").on("click",function(){rightmenuCopyText(domhref),btf.snackbarShow("\u5DF2\u590D\u5236\u94FE\u63A5\u5730\u5740")}),$("#menu-copyimg").on("click",function(){writeClipImg(domImgSrc)}),$("#menu-downloadimg").on("click",function(){downloadImage(domImgSrc,"tzy1997")}),$("#menu-copytext").on("click",function(){rightmenuCopyText(selectTextNow,"add-copyright"),btf.snackbarShow("\u590D\u5236\u6210\u529F"),removeRightMenu()}),$("#menu-searchBaidu").on("click",function(){searchBaidu()}),$("#menu-print").on("click",function(){removeRightMenu(),window.print()}),$("#menu-readmode").on("click",function(){let a=document.body.classList.length;switchReadMode(a)}),$("#rightmenu-mask").on("click",function(){removeRightMenu()}),$("#rightmenu-mask").contextmenu(function(){return removeRightMenu(),!1})