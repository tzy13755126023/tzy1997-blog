var rm={};rm.showRightMenu=function(e,n=0,t=0){var o=$("#rightMenu");o.css("top",n+"px").css("left",t+"px"),e?(stopMaskScroll(),o.show()):o.hide()};var rmWidth=$("#rightMenu").width(),rmHeight=$("#rightMenu").height();rm.reloadrmSize=function(){rmWidth=$("#rightMenu").width(),rmHeight=$("#rightMenu").height()};var domhref="",domImgSrc="",selectTextNow="";function selceText(){var e;selectTextNow=(e=document.selection?document.selection.createRange().text:window.getSelection()+"")?e:""}function removeRightMenu(){rm.showRightMenu(!1),$("#rightmenu-mask").attr("style","display: none")}function stopMaskScroll(){if(document.getElementById("rightmenu-mask")){var e=document.getElementById("rightmenu-mask");e.addEventListener("mousewheel",function(e){removeRightMenu()},!1)}if(document.getElementById("rightMenu")){var e=document.getElementById("rightMenu");e.addEventListener("mousewheel",function(e){removeRightMenu()},!1)}}function switchDarkMode(){removeRightMenu();let e="dark"===document.documentElement.getAttribute("data-theme")?"dark":"light";"light"===e?(activateDarkMode(),saveToLocal.set("theme","dark",2),void 0!==GLOBAL_CONFIG.Snackbar&&btf.snackbarShow(GLOBAL_CONFIG.Snackbar.day_to_night)):(activateLightMode(),saveToLocal.set("theme","light",2),void 0!==GLOBAL_CONFIG.Snackbar&&btf.snackbarShow(GLOBAL_CONFIG.Snackbar.night_to_day)),"function"==typeof utterancesTheme&&utterancesTheme(),"object"==typeof FB&&window.loadFBComment(),window.DISQUS&&document.getElementById("disqus_thread").children.length&&setTimeout(()=>window.disqusReset(),200)}function copyUrl(e){$("body").after("<input id='copyVal'></input>");var n=document.getElementById("copyVal");n.value=e,n.select(),n.setSelectionRange(0,n.value.length),document.execCommand("copy"),$("#copyVal").remove()}function copyPageUrl(){copyUrl(window.location.href),btf.snackbarShow("复制本页链接地址成功"),removeRightMenu()}function rightmenuCopyText(e,n="no-add"){var t;let o=GLOBAL_CONFIG.copyright;t="add-copyright"==n&&e.length>o.limitCount?e+"\n\n\n"+o.languages.author+"\n"+o.languages.link+window.location.href+"\n"+o.languages.source+"\n"+o.languages.info:e,navigator.clipboard&&navigator.clipboard.writeText(t),removeRightMenu()}function imageToBlob(e){console.log(e);let n=new Image;image.crossOrigin="Anonymous";let t=document.createElement("canvas"),o=t.getContext("2d");return n.crossOrigin="",n.src=e,new Promise(e=>{n.onload=function(){t.width=this.naturalWidth,t.height=this.naturalHeight,o.drawImage(this,0,0),t.toBlob(n=>{e(n)},"image/png",.75)}})}async function copyImage(e){let n=await imageToBlob(e),t=new ClipboardItem({"image/png":n});navigator.clipboard.write([t])}function writeClipImg(e){if(removeRightMenu(),-1==e.indexOf(location.host)){btf.snackbarShow("图片不同源，由于CORS限制，将无法提取位图！");return}btf.snackbarShow("正在下载中，请稍后",!1,1e4),!1==rm.downloadimging&&(rm.downloadimging=!0,setTimeout(function(){copyImage(e),btf.snackbarShow("复制成功！图片已添加盲水印，请遵守版权协议"),rm.downloadimging=!1},"10000"))}function downloadImage(e,n){removeRightMenu(),setTimeout(function(){var t=document.createElement("a"),o=new MouseEvent("click");t.download=n||"photo",t.href=e,t.click(),t.dispatchEvent(o),rm.downloadimging=!1},2e3)}function searchBaidu(){btf.snackbarShow("即将跳转到百度搜索"),setTimeout(function(){window.open("https://www.baidu.com/s?wd="+selectTextNow)},"2000"),removeRightMenu()}document.onmouseup=document.ondbclick=selceText,window.oncontextmenu=function(e){if(document.body.clientWidth>768){if(e.ctrlKey)return!0;var n=e.clientX+10,t=e.clientY,o=$(".rightMenuNormal"),i=$(".rightMenuOther"),c=$(".rightMenuPlugin"),r=$("#menu-copytext"),a=$("#menu-commenttext"),l=$("#menu-newwindow"),m=$("#menu-copylink"),u=$("#menu-copyimg"),h=$("#menu-downloadimg"),s=$("#menu-search"),d=$("#menu-searchBaidu"),g=$("#menu-readmode"),f=$("#menu-goto-comment"),w=e.target.href,p=e.target.currentSrc,v=location.href.includes("articles"),k=!1;return o.show(),i.show(),document.getElementById("post")||document.getElementById("page")?f.show():f.hide(),selectTextNow&&window.getSelection()?(k=!0,r.show(),a.show(),s.show(),d.show(),i.hide()):(r.hide(),a.hide(),d.hide(),s.hide()),w||p?(k=!0,l.show(),m.show(),i.hide(),w&&(domhref=w),p?(domImgSrc=p,domhref=p,u.show(),h.show()):(u.hide(),h.hide())):(u.hide(),h.hide(),l.hide(),m.hide()),v?g.show():g.hide(),k?c.show():c.hide(),rm.reloadrmSize(),n+rmWidth>window.innerWidth&&(n-=rmWidth),t+rmHeight>window.innerHeight&&(t-=rmHeight),rm.showRightMenu(!0,t,n),$("#rightmenu-mask").attr("style","display: flex"),!1}},$("#menu-backward").on("click",function(){window.history.back()}),$("#menu-forward").on("click",function(){window.history.forward()}),$("#menu-refresh").on("click",function(){window.location.reload()}),$("#menu-darkmode").on("click",function(){switchDarkMode()}),$("#menu-home").on("click",function(){window.location.href=window.location.origin}),$(".menu-link").on("click",function(){removeRightMenu()}),rm.downloadimging=!1;insertAtCaret:(e,n)=>{let t=e.selectionStart,o=e.selectionEnd;if(document.selection){var i;e.focus(),document.selection.createRange().text=n,e.focus()}else if(t||"0"==t){var c=e.scrollTop;e.value=e.value.substring(0,t)+n+e.value.substring(o,e.value.length),e.focus(),e.selectionStart=t+n.length,e.selectionEnd=t+n.length,e.scrollTop=c}else e.value+=n,e.focus()};function switchReadMode(e){var n;let t=document.body;function o(){t.classList.remove("read-mode"),n.remove(),n.removeEventListener("click",o)}0==e?(t.classList.add("read-mode"),(n=document.createElement("button")).type="button",n.className="fas fa-sign-out-alt exit-readmode",t.appendChild(n),n.addEventListener("click",o)):o(),removeRightMenu()}function replaceAll(e,n,t){return e.split(n).join(t)}function rightMenuCommentText(e){removeRightMenu();var n=document.getElementsByClassName("el-textarea__inner")[0],t=document.createEvent("HTMLEvents");t.initEvent("input",!0,!0);var o=replaceAll(e,"\n","\n> ");n.value="> "+o+"\n\n",n.dispatchEvent(t);var i=document.querySelector("#post-comment").offsetTop;window.scrollTo(0,i-80),n.focus(),n.setSelectionRange(-1,-1)}$("#menu-copy").on("click",function(){copyPageUrl()}),$("#menu-newwindow").on("click",function(){window.open(domhref),removeRightMenu()}),$("#menu-copylink").on("click",function(){rightmenuCopyText(domhref),btf.snackbarShow("已复制链接地址")}),$("#menu-copyimg").on("click",function(){writeClipImg(domImgSrc)}),$("#menu-downloadimg").on("click",function(){downloadImage(domImgSrc,"tzy1997")}),$("#menu-copytext").on("click",function(){rightmenuCopyText(selectTextNow,"add-copyright"),btf.snackbarShow("复制成功"),removeRightMenu()}),$("#menu-searchBaidu").on("click",function(){searchBaidu()}),$("#menu-commenttext").on("click",function(){rightMenuCommentText(selectTextNow)}),$("#menu-print").on("click",function(){removeRightMenu(),window.print()}),$("#menu-readmode").on("click",function(){let e=document.body.classList.length;switchReadMode(e)}),$("#menu-goto-comment").on("click",function(){removeRightMenu()}),$("#rightmenu-mask").on("click",function(){removeRightMenu()}),$("#rightmenu-mask").contextmenu(function(){return removeRightMenu(),!1}),$(".joe_wallpaper__type-list>li").on("click",function(){$(this).addClass("active"),$(this).siblings().removeClass("active");var e="#item-"+$(this).attr("data-cid");$(e).addClass("item-show").siblings().removeClass("item-show")});